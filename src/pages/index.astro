---
import Layout from '~/layouts/PageLayout.astro';

import Hero from '~/components/widgets/Hero.astro';
import Features from '~/components/widgets/Features.astro';
import Features2 from '~/components/widgets/Features2.astro';
import Steps from '~/components/widgets/Steps.astro';
import Content from '~/components/widgets/Content.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import Contact from '~/components/widgets/Contact.astro';
import Map from '~/components/widgets/Map.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import { YouTube } from 'astro-embed';
import stepsImage from '~/assets/images/tingey-injury-law-firm-L4YGuSg0fxs-unsplash.jpg';

const metadata = {
  title: 'HDO Abogados | Asesoría Legal e Insolvencias en Ibagué',
  description:
    'Abogado en Ibagué experto en Insolvencias, Derecho Penal, Laboral y Civil. David Ortiz ofrece asesoría legal honesta y primera consulta gratuita. Soluciones efectivas en todo el país.',
  ignoreTitleTemplate: true,
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget ******************* -->

  <Hero
    actions={[
      {
        variant: 'primary',
        text: 'Agenda tu consulta',
        href: 'https://wa.me/573227601479?text=Hola,%20tengo%20una%20consulta',
        target: '_blank',
        icon: 'tabler:brand-whatsapp',
      },
      { text: 'Conoce mis servicios', href: '#servicios' },
    ]}
  >
    <Fragment slot="title"> Asesoría legal clara, honesta y efectiva en Colombia. </Fragment>

    <Fragment slot="subtitle">
      <span class="hidden sm:inline">
        Muchas gracias por visitar mi página. Estoy aquí para escucharte, orientarte y defenderte con transparencia y
        compromiso, brindándote soluciones legales efectivas y accesibles.</span
      >
    </Fragment>
  </Hero>

  <!-- Features Widget *************** -->

  <Features2
    id="caracteristicas"
    title="¿Por qué confiar en HDO Abogados?"
    subtitle="Características que nos diferencian"
    items={[
      {
        title: 'Primera consulta sin costo',
        description: 'Evalúo tu caso sin compromiso para darte claridad sobre tus opciones.',
        icon: 'tabler:gift',
      },
      {
        title: 'Vocación de Prosperidad',
        description: 'Actúo con rigor y honestidad: le diré claramente si su caso es jurídicamente viable.',
        icon: 'tabler:check',
      },
      {
        title: 'Precios claros desde el inicio',
        description: 'Sin sorpresas. Conocerás los costos antes de iniciar.',
        icon: 'tabler:credit-card',
      },
      {
        title: 'Atención personalizada',
        description: 'Tú hablas directamente conmigo, no con asistentes.',
        icon: 'tabler:user-heart',
      },
      {
        title: 'Seguimiento constante',
        description: 'Te mantengo informado en cada etapa de tu proceso.',
        icon: 'tabler:messages',
      },
      {
        title: 'Experiencia',
        description: 'Gracias a mi experiencia, ofrezco acompañamiento eficaz orientado a resultados.',
        icon: 'tabler:award',
      },
    ]}
  />

  <Features
    id="servicios"
    tagline="Servicios"
    title="Áreas de práctica"
    subtitle="Te ofrecemos los siguientes servicios"
    items={[
      {
        title: 'Insolvencias Económicas',
        description:
          'A través de este proceso recuperarás el control de tu salario, reorganizarás tus deudas y propondrás acuerdos de pago con tus acreedores basado en tu disponibilidad económica.',
        icon: 'tabler:currency-dollar',
      },
      {
        title: 'Derecho Penal',
        description: 'Te represento con profesionalismo y ética en tus casos penales.',
        icon: 'tabler:swords',
      },
      {
        title: 'Derecho Laboral',
        description:
          'Te apoyo en reclamaciones laborales, despidos injustificados, liquidaciones, acoso laboral, pensiones y otros conflictos entre trabajadores y empleadores.',
        icon: 'tabler:briefcase',
      },
      {
        title: 'Derecho Civil',
        description:
          'Soluciones para conflictos contractuales, arrendamientos, deudas, responsabilidad civil, sucesiones y otros asuntos entre particulares.',
        icon: 'tabler:users-group',
      },
      {
        title: 'Conciliaciones',
        description:
          'Asesoría y representación en procesos de conciliación para resolver conflictos de manera rápida, efectiva y evitando llegar a instancias judiciales innecesarias.',
        icon: 'tabler:heart-handshake',
      },
      {
        title: 'Derecho Administrativo',
        description:
          'Acompañamiento en trámites y recursos frente a entidades públicas, sanciones administrativas, procesos disciplinarios y defensa ante la administración.',
        icon: 'tabler:building',
      },
      {
        title: 'Comparendos',
        description:
          'Te ayudo a impugnar comparendos de tránsito, revisar irregularidades en el proceso y defender tus derechos ante las autoridades de movilidad.',
        icon: 'tabler:motorbike',
      },
      {
        title: 'Derechos de petición, tutelas, desacatos',
        description:
          'Realizo tus peticiones, quejas, reclamos, solicitudes y sugerencias ante cualquier entidad administrativa buscando obtener respuestas rapidas.',
        icon: 'tabler:thumb-up',
      },
    ]}
  />

  <!-- Content Widget **************** -->

  <Content
    isReversed
    id="sobre-mi"
    tagline="Sobre mí"
    title="Conoce un poco sobre mi vocación y el compromiso que tengo de servir y ayudar a los demás."
    items={[
      {
        title: 'Experiencia y vocación',
        description:
          'Desde que cursaba 5 semestre de derecho tuve la oportunidad de hacer parte de un despacho de abogados de la defensoria publica',
      },
      {
        title: 'Atención cercana y transparente',
        description:
          'Trabajo con total seriedad y profesionalismo, con la convicción de que un servicio legal debe ser justo, claro y accesible para todos.',
      },
      {
        title: 'Honestidad y precios razonables',
        description:
          'Aquí encontrarás claridad en la información, trato honesto y precios razonables, sin sorpresas ni complicaciones.',
      },
    ]}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>

    <Fragment slot="image">
      <div class="relative h-0 pb-[56.25%]">
        <YouTube id="gxBkghlglTg" title="Presentación HDO Abogados" />
      </div>
      <style is:inline>
        lite-youtube {
          margin: 0 auto;
          max-width: 100%;
        }
      </style>
    </Fragment>
  </Content>

  <!-- Steps Widget ****************** -->

  <Steps
    id="como-trabajamos"
    title="¿Cómo trabajamos tu caso?"
    subtitle="Proceso claro y transparente en 4 pasos"
    items={[
      {
        title: 'Paso 1: <span class="font-medium">Consulta inicial</span>',
        description: 'Agendas una cita gratuita, me cuentas tu situación. Evalúo tu caso y te doy opciones reales.',
        icon: 'tabler:message-circle',
      },
      {
        title: 'Paso 2: <span class="font-medium">Estrategia legal</span>',
        description: 'Diseño la mejor estrategia para tu caso y te explico los costos, tiempos y posibilidades.',
        icon: 'tabler:checklist',
      },
      {
        title: 'Paso 3: <span class="font-medium">Ejecución</span>',
        description: 'Inicio las acciones legales necesarias. Te mantengo informado en cada paso.',
        icon: 'tabler:briefcase',
      },
      {
        title: 'Paso 4: <span class="font-medium">Solución</span>',
        description: 'Logramos el mejor resultado posible para tu caso.',
        icon: 'tabler:trophy',
      },
      {
        title: 'Ready!',
        icon: 'tabler:check',
      },
    ]}
    image={{
      src: stepsImage,
      alt: 'Steps image',
    }}
  />

  <!-- FAQs Widget ******************* -->

  <FAQs
    id="preguntas"
    title="Preguntas frecuentes"
    subtitle="Conoce las preguntas más frecuentes sobre mi trabajo."
    classes={{ container: 'max-w-6xl' }}
    items={[
      {
        title: '¿Cuánto cuesta la consulta inicial?',
        description:
          'La primera consulta es gratuita. En ella evaluamos tu caso y te indico si tu proceso tiene vocación de éxito.',
      },
      {
        title: '¿Cómo funciona el pago de honorarios?',
        description: 'Te ofrezco una forma de pago accesible a tu bolsillo con la facilidad de pago a cuotas.',
      },
      {
        title: '¿Qué necesito para la primera cita?',
        description:
          'Ten a la mano la documentación que tengas sobre tu caso, esto para revisar la viabilidad de tu proceso.',
      },
      {
        title: '¿Atienden casos en toda Colombia?',
        description: 'Sí, puedo atender casos en todo el país. También ofrezco asesoría virtual cuando sea necesario.',
      },
    ]}
  />

  <!-- Contact Widget **************** -->

  <Contact
    id="contacto"
    title="¿Necesitas asesoría legal?"
    subtitle="Déjame tus datos y te contacto en menos de 24 horas"
    action="https://api.web3forms.com/submit"
    method="POST"
    inputs={[
      { type: 'hidden', name: 'access_key', value: 'e2600ae2-2174-4b64-af2a-cf04b95b028f' },
      { type: 'hidden', name: 'subject', value: 'Nuevo Contacto - HDO Abogados' },
      { type: 'checkbox', name: 'botcheck', label: '', value: '', class: 'hidden', style: 'display: none;' },
      { type: 'text', name: 'name', label: 'Nombre completo', required: true },
      { type: 'email', name: 'email', label: 'Correo electrónico', required: true },
      { type: 'tel', name: 'phone', label: 'Teléfono/WhatsApp', required: true },
    ]}
    textarea={{
      label: 'Cuéntame tu caso',
      name: 'message',
    }}
    disclaimer={{
      label:
        'Al enviar este formulario de contacto, usted reconoce y acepta la recopilación de su información personal.',
    }}
    button="Agenda una consulta"
  />

  <script is:inline>
    const contactForm = document.getElementById('contacto')?.querySelector('form');
    // Encontrar el botón dentro del div que sigue al form o dentro del form
    // La estructura de Form.astro pone el botón DENTRO del form, así que esto debería funcionar
    const submitButton = contactForm?.querySelector('button[type="submit"]');
    const resultMessage = document.getElementById('form-result');

    if (contactForm && submitButton && resultMessage) {
      contactForm.addEventListener('submit', async (e) => {
        e.preventDefault(); // Evita que la página se recargue

        // Validación básica HTML5
        if (!contactForm.checkValidity()) {
          contactForm.reportValidity();
          return;
        }

        const originalBtnText = submitButton.innerText;
        submitButton.innerHTML = `
          <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Enviando...
        `;
        submitButton.disabled = true;

        // Ocultar mensaje previo
        resultMessage.classList.add('hidden');
        resultMessage.className = 'mt-4 hidden p-4 rounded-lg text-sm text-center font-medium';

        // Actualizar asunto con datos dinámicos
        const subjectInput = contactForm.querySelector('input[name="subject"]');
        const nameInput = contactForm.querySelector('input[name="name"]');
        if (subjectInput && nameInput) {
          const userName = nameInput.value || 'Cliente';
          const timestamp = new Date().toLocaleString('es-CO');
          subjectInput.value = `Nuevo Contacto: ${userName} (${timestamp})`;
        }

        try {
          const formData = new FormData(contactForm);
          const object = Object.fromEntries(formData);
          const json = JSON.stringify(object);

          // Timeout de 10 segundos
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 10000);

          const response = await fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Accept: 'application/json',
            },
            body: json,
            signal: controller.signal,
          });

          clearTimeout(timeoutId);
          const result = await response.json();

          if (result.success) {
            // Éxito: Mostrar mensaje y limpiar
            contactForm.reset();
            resultMessage.textContent = '¡Gracias! He recibido tu mensaje. Me pondré en contacto contigo muy pronto.';
            resultMessage.classList.remove(
              'hidden',
              'bg-red-100',
              'text-red-700',
              'dark:bg-red-900/20',
              'dark:text-red-400'
            );
            resultMessage.classList.add(
              'bg-green-100',
              'text-green-700',
              'dark:bg-green-900/20',
              'dark:text-green-400',
              'border',
              'border-green-200',
              'dark:border-green-800'
            );
            resultMessage.classList.remove('hidden');

            // Auto-ocultar mensaje de éxito
            setTimeout(() => {
              resultMessage.classList.add('hidden');
            }, 8000);
          } else {
            // Error API
            console.error(result);
            throw new Error(result.message || 'Error en el servicio');
          }
        } catch (error) {
          console.error(error);
          let msg = 'Hubo un problema al enviar el mensaje. Por favor intenta nuevamente.';
          if (error.name === 'AbortError') {
            msg = 'El envío está tardando demasiado. Por favor verifica tu conexión.';
          }

          resultMessage.textContent = msg;
          resultMessage.classList.remove(
            'hidden',
            'bg-green-100',
            'text-green-700',
            'dark:bg-green-900/20',
            'dark:text-green-400'
          );
          resultMessage.classList.add(
            'bg-red-100',
            'text-red-700',
            'dark:bg-red-900/20',
            'dark:text-red-400',
            'border',
            'border-red-200',
            'dark:border-red-800'
          );
          resultMessage.classList.remove('hidden');
        } finally {
          submitButton.innerHTML = originalBtnText;
          submitButton.disabled = false;
        }
      });
    }
  </script>

  <Features2
    title="Estoy aquí para ayudarte"
    items={[
      {
        title: 'Primera consulta gratuita',
        description: 'Evalúo tu caso sin compromiso para darte claridad sobre tus opciones legales.',
      },
      {
        title: 'Respuesta rápida',
        description: 'Respondo en menos de 24 horas. Tu caso es urgente para mí y te daré una respuesta oportuna.',
      },
      {
        title: 'Atención personalizada',
        description:
          'Hablas directamente conmigo, no con asistentes. Recibirás atención profesional y cercana en cada etapa.',
      },
      {
        title: 'WhatsApp',
        description: '+57 322 760 1479',
        icon: 'tabler:brand-whatsapp',
      },
      {
        title: 'Email',
        description: 'hdortizv@ut.edu.co',
        icon: 'tabler:mail',
      },
      {
        title: 'Ubicación',
        description: 'Ibagué, Colombia <br> Calle 9 #1-124, oficina 207, frente al palacio justicia',
        icon: 'tabler:map-pin',
      },
    ]}
  />

  <Map
    id="ubicacion"
    title="Ubicación"
    subtitle="Estamos ubicados en Ibagué, Tolima. Atendemos casos en todo el país."
  />

  <!-- CallToAction Widget *********** -->

  <CallToAction
    actions={[
      {
        variant: 'primary',
        text: 'Agenda tu consulta',
        href: 'https://wa.me/573227601479?text=Hola,%20tengo%20una%20consulta',
        target: '_blank',
        icon: 'tabler:brand-whatsapp',
      },
    ]}
  >
    <Fragment slot="title">
      Agenda tu consulta&nbsp;con&nbsp;<br class="block sm:hidden" /><span class="sm:whitespace-nowrap"
        >David Ortiz</span
      >
    </Fragment>

    <Fragment slot="subtitle">
      Estoy listo para escucharte y ayudarte con tu caso. <br class="hidden md:inline" />Contáctame por WhatsApp o
      completa el formulario de contacto.
    </Fragment>
  </CallToAction>
</Layout>
